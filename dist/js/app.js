(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var GameOfLife = require('./game-of-life');

const canvas = document.getElementById('gol');
const start = document.getElementById('start');
const speed = document.getElementById('speed');
const clear = document.getElementById('clear');

let game = new GameOfLife(canvas);

var drawing = false;
var drawMode = false;

canvas.onmousedown = function (e) {
    drawing = true;
    let x = parseInt(e.offsetX / 10);
    let y = parseInt(e.offsetY / 10);
    drawMode = !game.isAlive(x, y);
};

canvas.onmouseup = function () {
    drawing = false;
};

canvas.onmousemove = function (e) {
    if (!drawing) {
        return;
    }
    let x = parseInt(e.offsetX / 10);
    let y = parseInt(e.offsetY / 10);
    game.set(x, y, drawMode);
};

speed.onchange = function () {
    game.setSpeed(parseInt(this.value));
};

start.onclick = function () {
    if (this.innerText === 'Start') {
        game.start();
        start.innerText = 'Pause';
    } else {
        game.pause();
        start.innerText = 'Start';
    }
};

clear.onclick = function () {
    game.reset();
};

},{"./game-of-life":2}],2:[function(require,module,exports){
"use strict";

module.exports = class GameOfLife {

    constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.ctx.lineWidth = 1;
        this.ctx.strokeStyle = 'rgba(0, 0, 0, .2)';
        this.grid = [];
        this.lastUpdate = +new Date();
        this.running = false;
        this.speed = 100;

        this.reset();
        this.draw();
    }

    isAlive(x, y) {
        return this.grid[x][y];
    }

    set(x, y, alive) {
        this.grid[x][y] = alive;
    }

    setSpeed(value) {
        this.speed = value;
    }

    start() {
        this.running = true;
    }

    pause() {
        this.running = false;
    }

    reset() {
        for (let x = 0; x < 80; x++) {
            if (this.grid[x] === undefined) {
                this.grid[x] = [];
            }
            for (var y = 0; y < 80; y++) {
                this.grid[x][y] = false;
            }
        }
    }

    drawLines() {
        for (let i = 0; i < 80; i++) {
            this.ctx.beginPath();
            this.ctx.moveTo(10 * i, 0);
            this.ctx.lineTo(10 * i, this.canvas.width);
            this.ctx.stroke();

            this.ctx.beginPath();
            this.ctx.moveTo(0, 10 * i);
            this.ctx.lineTo(this.canvas.height, 10 * i);
            this.ctx.stroke();
        }
    }

    draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.drawLines();

        let changeset = [];
        let doUpdate = false;

        if (this.running && this.lastUpdate < +new Date() - this.speed) {
            this.lastUpdate = +new Date();
            doUpdate = true;
        }

        for (let x = 0; x < this.grid.length; x++) {
            for (let y = 0; y < this.grid[x].length; y++) {

                if (doUpdate) {
                    this.update(x, y, changeset);
                }

                if (this.grid[x][y]) {
                    this.ctx.fillRect(x * 10, y * 10, 10, 10);
                }
            }
        }

        for (let i = 0; i < changeset.length; i++) {
            this.grid[changeset[i].x][changeset[i].y] = changeset[i].alive;
        }

        setTimeout(this.draw.bind(this), 16);
    }

    update(x, y, changeset) {
        let neighborCount = this.getNeighborCount(x, y);
        let change = {
            x: x,
            y: y,
            alive: undefined
        };
        if (this.grid[x][y]) {
            if (neighborCount < 2) {
                change.alive = false;
            } else if (neighborCount === 2 || neighborCount === 3) {
                change.alive = true;
            } else if (neighborCount > 3) {
                change.alive = false;
            }
        } else {
            if (neighborCount === 3) {
                change.alive = true;
            }
        }

        if (change.alive !== undefined) {
            changeset.push(change);
        }
    }

    getX(x) {
        if (x >= 80) {
            return 0;
        } else if (x < 0) {
            return 79;
        }
        return x;
    }

    getY(y) {
        if (y >= 80) {
            return 0;
        } else if (y < 0) {
            return 79;
        }
        return y;
    }

    getNeighborCount(x, y) {
        let neighborCount = 0;
        let grid = this.grid;

        // top left
        neighborCount += grid[this.getX(x - 1)][this.getY(y - 1)] ? 1 : 0;
        // top middle
        neighborCount += grid[this.getX(x)][this.getY(y - 1)] ? 1 : 0;
        // top right
        neighborCount += grid[this.getX(x + 1)][this.getY(y - 1)] ? 1 : 0;
        // middle left
        neighborCount += grid[this.getX(x - 1)][this.getY(y)] ? 1 : 0;
        // middle right
        neighborCount += grid[this.getX(x + 1)][this.getY(y)] ? 1 : 0;
        // bottom left
        neighborCount += grid[this.getX(x - 1)][this.getY(y + 1)] ? 1 : 0;
        // bottom middle
        neighborCount += grid[this.getX(x)][this.getY(y + 1)] ? 1 : 0;
        // bottom right
        neighborCount += grid[this.getX(x + 1)][this.getY(y + 1)] ? 1 : 0;

        return neighborCount;
    }
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHBcXHNjcmlwdHNcXGFwcC5qcyIsImFwcFxcc2NyaXB0c1xcZ2FtZS1vZi1saWZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUFBWSxDQUFDOztBQUNiLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDOztBQUUzQyxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzlDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDL0MsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMvQyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDOztBQUUvQyxJQUFJLElBQUksR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFbEMsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBQ3BCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQzs7QUFFckIsTUFBTSxDQUFDLFdBQVcsR0FBRyxVQUFTLENBQUMsRUFBQztBQUM1QixXQUFPLEdBQUcsSUFBSSxDQUFDO0FBQ2YsUUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUM7QUFDakMsUUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUM7QUFDakMsWUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Q0FDbEMsQ0FBQTs7QUFFRCxNQUFNLENBQUMsU0FBUyxHQUFHLFlBQVU7QUFDekIsV0FBTyxHQUFHLEtB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SSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDOztBQUFDLEFBRTlELHFCQUFhLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDOztBQUFDLEFBRTlELHFCQUFhLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQzs7QUFBQyxBQUVsRSxxQkFBYSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQzs7QUFBQyxBQUU5RCxxQkFBYSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7QUFFbEUsZUFBTyxhQUFhLENBQUM7S0FDeEI7Q0FDSixDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlwidXNlIHN0cmljdFwiO1xudmFyIEdhbWVPZkxpZmUgPSByZXF1aXJlKCcuL2dhbWUtb2YtbGlmZScpO1xyXG5cclxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvbCcpO1xyXG5jb25zdCBzdGFydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydCcpO1xyXG5jb25zdCBzcGVlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzcGVlZCcpO1xyXG5jb25zdCBjbGVhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcicpO1xyXG5cclxubGV0IGdhbWUgPSBuZXcgR2FtZU9mTGlmZShjYW52YXMpO1xyXG5cclxudmFyIGRyYXdpbmcgPSBmYWxzZTtcclxudmFyIGRyYXdNb2RlID0gZmFsc2U7XHJcblxyXG5jYW52YXMub25tb3VzZWRvd24gPSBmdW5jdGlvbihlKXtcclxuICAgIGRyYXdpbmcgPSB0cnVlO1xyXG4gICAgbGV0IHggPSBwYXJzZUludChlLm9mZnNldFggLyAxMCk7XHJcbiAgICBsZXQgeSA9IHBhcnNlSW50KGUub2Zmc2V0WSAvIDEwKTtcclxuICAgIGRyYXdNb2RlID0gIWdhbWUuaXNBbGl2ZSh4LCB5KTtcclxufVxyXG5cclxuY2FudmFzLm9ubW91c2V1cCA9IGZ1bmN0aW9uKCl7XHJcbiAgICBkcmF3aW5nID0gZmFsc2U7XHJcbn1cclxuXHJcbmNhbnZhcy5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGUpe1xyXG4gICAgaWYoIWRyYXdpbmcpe1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCB4ID0gcGFyc2VJbnQoZS5vZmZzZXRYIC8gMTApO1xyXG4gICAgbGV0IHkgPSBwYXJzZUludChlLm9mZnNldFkgLyAxMCk7XHJcbiAgICBnYW1lLnNldCh4LCB5LCBkcmF3TW9kZSk7XHJcbn1cclxuXHJcbnNwZWVkLm9uY2hhbmdlID0gZnVuY3Rpb24oKXtcclxuICAgIGdhbWUuc2V0U3BlZWQocGFyc2VJbnQodGhpcy52YWx1ZSkpO1xyXG59XHJcblxyXG5zdGFydC5vbmNsaWNrID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuaW5uZXJUZXh0ID09PSAnU3RhcnQnKXtcclxuICAgICAgICBnYW1lLnN0YXJ0KCk7XHJcbiAgICAgICAgc3RhcnQuaW5uZXJUZXh0ID0gJ1BhdXNlJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ2FtZS5wYXVzZSgpO1xyXG4gICAgICAgIHN0YXJ0LmlubmVyVGV4dCA9ICdTdGFydCc7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsZWFyLm9uY2xpY2sgPSBmdW5jdGlvbigpe1xyXG4gICAgZ2FtZS5yZXNldCgpO1xyXG59XHJcbiIsIlwidXNlIHN0cmljdFwiO1xubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBHYW1lT2ZMaWZlIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMpe1xyXG4gICAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xyXG4gICAgICAgIHRoaXMuY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDAsIDAsIDAsIC4yKSc7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gW107XHJcbiAgICAgICAgdGhpcy5sYXN0VXBkYXRlID0gK25ldyBEYXRlKCk7XHJcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zcGVlZCA9IDEwMDtcclxuXHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQWxpdmUoeCwgeSl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFt4XVt5XTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQoeCwgeSwgYWxpdmUpe1xyXG4gICAgICAgIHRoaXMuZ3JpZFt4XVt5XSA9IGFsaXZlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNwZWVkKHZhbHVlKXtcclxuICAgICAgICB0aGlzLnNwZWVkID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhcnQoKXtcclxuICAgICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHBhdXNlKCl7XHJcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXQoKXtcclxuICAgICAgICBmb3IobGV0IHggPSAwOyB4IDwgODA7IHgrKyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZ3JpZFt4XSA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFt4XSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvcih2YXIgeSA9IDA7IHkgPCA4MDsgeSsrKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFt4XVt5XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRyYXdMaW5lcygpe1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbygxMCAqIGksIDApXHJcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbygxMCAqIGksIHRoaXMuY2FudmFzLndpZHRoKTtcclxuICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKDAsIDEwICogaSlcclxuICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKHRoaXMuY2FudmFzLmhlaWdodCwgMTAgKiBpKTtcclxuICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRyYXcoKXtcclxuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5kcmF3TGluZXMoKTtcclxuXHJcbiAgICAgICAgbGV0IGNoYW5nZXNldCA9IFtdO1xyXG4gICAgICAgIGxldCBkb1VwZGF0ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBpZih0aGlzLnJ1bm5pbmcgJiYgdGhpcy5sYXN0VXBkYXRlIDwgK25ldyBEYXRlKCkgLSB0aGlzLnNwZWVkKXtcclxuICAgICAgICAgICAgdGhpcy5sYXN0VXBkYXRlID0gK25ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIGRvVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvcihsZXQgeCA9IDA7IHggPCB0aGlzLmdyaWQubGVuZ3RoOyB4Kyspe1xyXG4gICAgICAgICAgICBmb3IobGV0IHkgPSAwOyB5IDwgdGhpcy5ncmlkW3hdLmxlbmd0aDsgeSsrKXtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihkb1VwZGF0ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoeCwgeSwgY2hhbmdlc2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmdyaWRbeF1beV0pe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KHggKiAxMCwgeSAqIDEwLCAxMCwgMTApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2hhbmdlc2V0Lmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgdGhpcy5ncmlkW2NoYW5nZXNldFtpXS54XVtjaGFuZ2VzZXRbaV0ueV0gPSBjaGFuZ2VzZXRbaV0uYWxpdmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KHRoaXMuZHJhdy5iaW5kKHRoaXMpLCAxNik7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKHgsIHksIGNoYW5nZXNldCl7XHJcbiAgICAgICAgbGV0IG5laWdoYm9yQ291bnQgPSB0aGlzLmdldE5laWdoYm9yQ291bnQoeCwgeSk7XHJcbiAgICAgICAgbGV0IGNoYW5nZSA9IHtcclxuICAgICAgICAgICAgeDogeCxcclxuICAgICAgICAgICAgeTogeSxcclxuICAgICAgICAgICAgYWxpdmU6IHVuZGVmaW5lZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYodGhpcy5ncmlkW3hdW3ldKXtcclxuICAgICAgICAgICAgaWYobmVpZ2hib3JDb3VudCA8IDIpe1xyXG4gICAgICAgICAgICAgICAgY2hhbmdlLmFsaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihuZWlnaGJvckNvdW50ID09PSAyIHx8IG5laWdoYm9yQ291bnQgPT09IDMpe1xyXG4gICAgICAgICAgICAgICAgY2hhbmdlLmFsaXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKG5laWdoYm9yQ291bnQgPiAzKXtcclxuICAgICAgICAgICAgICAgIGNoYW5nZS5hbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYobmVpZ2hib3JDb3VudCA9PT0gMyl7XHJcbiAgICAgICAgICAgICAgICBjaGFuZ2UuYWxpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihjaGFuZ2UuYWxpdmUgIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIGNoYW5nZXNldC5wdXNoKGNoYW5nZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFgoeCl7XHJcbiAgICAgICAgaWYoeCA+PSA4MCl7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0gZWxzZSBpZih4IDwgMCl7XHJcbiAgICAgICAgICAgIHJldHVybiA3OTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0WSh5KXtcclxuICAgICAgICBpZih5ID49IDgwKXtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSBlbHNlIGlmKHkgPCAwKXtcclxuICAgICAgICAgICAgcmV0dXJuIDc5O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4geVxyXG4gICAgfVxyXG5cclxuICAgIGdldE5laWdoYm9yQ291bnQoeCwgeSl7XHJcbiAgICAgICAgbGV0IG5laWdoYm9yQ291bnQgPSAwO1xyXG4gICAgICAgIGxldCBncmlkID0gdGhpcy5ncmlkO1xyXG5cclxuICAgICAgICAvLyB0b3AgbGVmdFxyXG4gICAgICAgIG5laWdoYm9yQ291bnQgKz0gZ3JpZFt0aGlzLmdldFgoeCAtIDEpXVt0aGlzLmdldFkoeSAtIDEpXSA/IDEgOiAwO1xyXG4gICAgICAgIC8vIHRvcCBtaWRkbGVcclxuICAgICAgICBuZWlnaGJvckNvdW50ICs9IGdyaWRbdGhpcy5nZXRYKHgpXVt0aGlzLmdldFkoeSAtIDEpXSA/IDEgOiAwO1xyXG4gICAgICAgIC8vIHRvcCByaWdodFxyXG4gICAgICAgIG5laWdoYm9yQ291bnQgKz0gZ3JpZFt0aGlzLmdldFgoeCArIDEpXVt0aGlzLmdldFkoeSAtIDEpXSA/IDEgOiAwO1xyXG4gICAgICAgIC8vIG1pZGRsZSBsZWZ0XHJcbiAgICAgICAgbmVpZ2hib3JDb3VudCArPSBncmlkW3RoaXMuZ2V0WCh4IC0gMSldW3RoaXMuZ2V0WSh5KV0gPyAxIDogMDtcclxuICAgICAgICAvLyBtaWRkbGUgcmlnaHRcclxuICAgICAgICBuZWlnaGJvckNvdW50ICs9IGdyaWRbdGhpcy5nZXRYKHggKyAxKV1bdGhpcy5nZXRZKHkpXSA/IDEgOiAwO1xyXG4gICAgICAgIC8vIGJvdHRvbSBsZWZ0XHJcbiAgICAgICAgbmVpZ2hib3JDb3VudCArPSBncmlkW3RoaXMuZ2V0WCh4IC0gMSldW3RoaXMuZ2V0WSh5ICsgMSldID8gMSA6IDA7XHJcbiAgICAgICAgLy8gYm90dG9tIG1pZGRsZVxyXG4gICAgICAgIG5laWdoYm9yQ291bnQgKz0gZ3JpZFt0aGlzLmdldFgoeCldW3RoaXMuZ2V0WSh5ICsgMSldID8gMSA6IDA7XHJcbiAgICAgICAgLy8gYm90dG9tIHJpZ2h0XHJcbiAgICAgICAgbmVpZ2hib3JDb3VudCArPSBncmlkW3RoaXMuZ2V0WCh4ICsgMSldW3RoaXMuZ2V0WSh5ICsgMSldID8gMSA6IDA7XHJcblxyXG4gICAgICAgIHJldHVybiBuZWlnaGJvckNvdW50O1xyXG4gICAgfVxyXG59O1xyXG4iXX0=
